<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Node Auth App - Login & Register</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Inter, sans-serif;
            background: #f3f4f6;
        }
    </style>
</head>

<body class="flex items-center justify-center min-h-screen p-4">
    <div class="auth-container w-full max-w-md bg-white shadow-2xl rounded-xl overflow-hidden">
        <div class="flex border-b border-gray-200">
            <button id="tab-login"
                class="w-1/2 p-4 text-center font-semibold border-b-4 border-indigo-600 text-indigo-700 bg-indigo-50"
                onclick="showForm('login')">Login</button>
            <button id="tab-register"
                class="w-1/2 p-4 text-center font-semibold text-gray-500 hover:text-indigo-700 hover:bg-indigo-50"
                onclick="showForm('register')">Register</button>
        </div>
        <div id="message-area" class="p-4 text-sm font-medium hidden"></div>
        <div class="p-6 md:p-8">
            <form id="login-form" class="space-y-6">
                <div><label for="login-email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="login-email" name="email" required
                        class="mt-1 block w-full px-4 py-2 border rounded-lg">
                </div>
                <div><label for="login-password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="login-password" name="password" required
                        class="mt-1 block w-full px-4 py-2 border rounded-lg">
                </div>
                <button type="submit" class="w-full py-3 rounded-lg text-white bg-indigo-600"><span
                        id="login-button-text">Log In</span></button>
            </form>
            <form id="register-form" class="space-y-6 hidden mt-6">
                <div><label for="reg-username" class="block text-sm font-medium text-gray-700">Username</label>
                    <input type="text" id="reg-username" name="username" required
                        class="mt-1 block w-full px-4 py-2 border rounded-lg">
                </div>
                <div><label for="reg-email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="reg-email" name="email" required
                        class="mt-1 block w-full px-4 py-2 border rounded-lg">
                </div>
                <div><label for="reg-password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="reg-password" name="password" required minlength="8"
                        class="mt-1 block w-full px-4 py-2 border rounded-lg">
                    <p class="mt-2 text-xs text-gray-500">Must be at least 8 characters.</p>
                </div>
                <button type="submit" class="w-full py-3 rounded-lg text-white bg-indigo-600"><span
                        id="register-button-text">Register Account</span></button>
            </form>
        </div>
    </div>
    <script>
        const API_URL = 'http://localhost:4000/api';
        const msg = document.getElementById('message-area');
        function showMessage(text, type = 'error') {
            msg.textContent = text;
            msg.className = 'p-4 text-sm font-medium';
            msg.classList.add(type === 'success' ? 'bg-green-100' : 'bg-red-100', 'text-' + (type === 'success' ? 'green' : 'red') + '-800');
            msg.classList.remove('hidden');
            setTimeout(() => msg.classList.add('hidden'), 5000);
        }
        async function submitForm(form, endpoint, successText) {
            const btn = form.querySelector('button');
            const span = btn.querySelector('span');
            const original = span.textContent;
            btn.disabled = true; span.textContent = 'Processing...';
            const data = Object.fromEntries(new FormData(form));
            try {
                const res = await fetch(API_URL + endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const json = await res.json();
                if (json.token) {
                    localStorage.setItem('token', json.token);
                    window.location.href = 'dashboard.html';
                    return;
                }
                if (json.success || json.message) {
                    showMessage(json.message || successText, json.success ? 'success' : 'error');
                    if (endpoint === '/register' && json.success) form.reset();
                }
            } catch (e) {
                showMessage('Connection error: ensure Node.js API is running.');
                console.error(e);
            } finally { btn.disabled = false; span.textContent = original; }
        }
        document.getElementById('login-form').addEventListener('submit', e => { e.preventDefault(); submitForm(e.target, '/login', 'Login successful'); });
        document.getElementById('register-form').addEventListener('submit', e => { e.preventDefault(); submitForm(e.target, '/register', 'Registration successful'); });
        window.showForm = function (name) {
            const isLogin = name === 'login';
            document.getElementById('login-form').classList.toggle('hidden', !isLogin);
            document.getElementById('register-form').classList.toggle('hidden', isLogin);
            document.getElementById('tab-login').classList.toggle('border-indigo-600', isLogin);
        }
    </script>
</body>

</html>