<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>
    <%= article.title %>
  </title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/stylesheets/style.css" />
</head>

<body>
  <%- include('../layout') %>

    <div class="page-container">
      <article style="background: white; padding: 2rem; border-radius: var(--radius); border: 1px solid var(--border);">
        <header style="margin-bottom: 2rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem;">
          <% if (article.image) { %>
            <div style="margin-bottom: 1.5rem; border-radius: var(--radius); overflow: hidden; max-height: 400px;">
              <img src="<%= article.image %>" alt="<%= article.title %>"
                style="width: 100%; height: 100%; object-fit: cover;">
            </div>
            <% } %>
              <h1 style="font-size: 2.5rem; font-weight: 800; margin-bottom: 1rem; line-height: 1.2;">
                <%= article.title %>
              </h1>
              <div style="color: var(--text-muted); font-size: 0.95rem;">
                By <span style="color: var(--text-main); font-weight: 600;">
                  <%= article.author ? (article.author.name || article.author.email || 'User #' + article.author.id)
                    : 'Unknown' %>
                </span>
                on <%= new Date(article.createdAt).toLocaleDateString(undefined, { weekday: 'long' , year: 'numeric' ,
                  month: 'long' , day: 'numeric' }) %>
              </div>
        </header>

        <div style="font-size: 1.125rem; line-height: 1.75; color: #374151; white-space: pre-wrap;">
          <%= article.content %>
        </div>

        <% const isOwner=currentUser && article.authorId===currentUser.id; const isAdmin=currentUser &&
          currentUser.role==='ADMIN' ; %>
          <% if (isOwner || isAdmin) { %>
            <div
              style="margin-top: 3rem; padding-top: 1.5rem; border-top: 1px solid var(--border); display: flex; gap: 1rem;">
              <a href="/articles/<%= article.id %>/edit" class="btn btn-outline">Edit Article</a>
              <form action="/articles/<%= article.id %>/delete" method="POST"
                onsubmit="return confirm('Are you sure you want to delete this article? This cannot be undone.');">
                <button type="submit" class="btn btn-danger">Delete Article</button>
              </form>
            </div>
            <% } %>
      </article>

      <div style="margin-top: 2rem;">
        <a href="/articles" style="color: var(--primary); font-weight: 500;">&larr; Back to all articles</a>
      </div>
    </div>
</body>

</html>